<div class="page-with-navbar">
  <div *ngIf="!showDetailView">
    <div class="page-with-navbar__header">
      <div class="container">
        <div class="flex-between mb-lg">
          <div class="header-actions">
            <button class="btn btn--primary" (click)="createArticle()">
              Créer un article
            </button>
          </div>

          <div class="filter-group">
            <button
              class="btn btn--sort"
              (click)="changeSortDirection()"
              [disabled]="isLoading"
            >
              Trier par {{ sortDirection === "desc" ? "↓" : "↑" }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="page-with-navbar__content">
      <div class="container">
        <div class="text-center p-xl" *ngIf="isLoading">
          <div class="loading-spinner"></div>
          <p class="text-secondary">Chargement des articles...</p>
        </div>

        <div *ngIf="!isLoading">
          <div class="grid" *ngIf="articles.length > 0">
            <article
              class="card card--clickable"
              *ngFor="let article of articles; trackBy: trackByArticleId"
              (click)="viewArticle(article)"
            >
              <h2 class="title">{{ article.title }}</h2>

              <div class="article-meta mb-sm">
                <span class="article-date">{{
                  article.createdAt | date: "dd/MM/yyyy"
                }}</span>
                <span class="article-author">{{ article.authorUsername }}</span>
              </div>

              <p class="article-content mb-md">
                {{ truncateContent(article.content) }}
              </p>
            </article>
          </div>
          
          <div *ngIf="articles.length === 0" class="text-center p-xl">
            <p class="text-secondary">Aucun article trouvé.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="showDetailView">
    <div class="page-with-navbar__header">
      <div class="container article-container">
        <img
          src="/assets/back_arrow.svg"
          alt="Retour"
          class="back-arrow"
          (click)="goBack()"
        />
        
      </div>
    </div>

    <div class="page-with-navbar__content">
      <div class="container">
        <div class="text-center p-xl" *ngIf="isLoading">
          <div class="loading-spinner"></div>
          <p class="text-secondary mt-md">Chargement de l'article...</p>
        </div>

        <div *ngIf="!isLoading && selectedArticle" class="article-detail">
          <article class="article">
            <h1 class="article-detail-title">{{ selectedArticle.title }}</h1>
            <div class="article-detail-meta">
              <p class="meta-item">
                {{ selectedArticle.createdAt | date: "dd/MM/yyyy" }}
              </p>
              <p class="meta-item">{{ selectedArticle.authorUsername }}</p>
              <p class="meta-item">{{ selectedArticle.subjectName }}</p>
            </div>

            <div class="article-detail-content">
              <p>{{ selectedArticle.content }}</p>
            </div>
          </article>

          <div class="comment-content">
            <app-comment
              [articleId]="selectedArticle.id"
              [initialComments]="comments"
            >
            </app-comment>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>